---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: immich
  namespace: flux-system
spec:
  chartRef:
    kind: OCIRepository
    name: immich
    namespace: flux-system
  install:
    createNamespace: true
  interval: 30m0s
  targetNamespace: immich
  values:
    immich:
      metrics:
        enabled: true
      persistence:
        library:
          existingClaim: immich-library
    env:
      DB_HOSTNAME: "immich-postgres-rw.postgres"
      DB_USERNAME: immich
      DB_DATABASE_NAME: immich
      DB_PASSWORD:
        secretKeyRef:
          name: immich-postgres
          key: password
